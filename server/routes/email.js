var router = require('express').Router();
var nodemailer = require('nodemailer');
var hsb = require('nodemailer-express-handlebars');

var transporter = nodemailer.createTransport({
    from: 'meetme.at.website@gmail.com',
    host: 'smtp.gmail.com',
    secure: true,
    port: 465,
    auth: {
        user: 'meetme.at.website@gmail.com',
        pass: 'meet me halfway down'
    }
});

// transporter.use('compile', hsb({
//     viewPath: __dirname + '/templates',
//     extName: '.hbs'
// }));

router.post('/api/send', function (req, res, next) {
    var mailOptions = {
        to: req.body.emailAddress,
        subject: req.body.subject,
        html: `
        <div class="header">
            <p>MeetMe@ : ${req.body.message.name}</p>
            <img src="data:image/png;base64,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" />
        </div>
        <div class="body" style="font-size:3rem; color: blue;">
            <p>Link to Your Directions: <a style="color:green;" href="${req.body.message.friendsDirections}">Google Maps (${req.body.message.friendsDirections})</a></p>
        </div>
        <div class="footer">
            <p>Your MeetMe@ Team</p>
        </div>    
        `,
    };
    transporter.sendMail(mailOptions, function (error, response) {
        if (error) {
            console.log(error);
            res.send({
                message: 'API ERROR',
                error
            })
        } else {
            res.send({
                response: "Sent"
            })
        }
    })
})

module.exports = {
    router
};